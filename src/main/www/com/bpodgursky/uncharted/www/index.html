<!DOCTYPE html>
<html lang="en">
<head>
  <title>three.js webgl - materials - cube reflection [balls]</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <style>
    body {
      background: #777;
      padding: 0;
      margin: 0;
      font-weight: bold;
      overflow: hidden;
    }

    #info {
      position: absolute;
      top: 0px;
      width: 100%;
      color: #ffffff;
      padding: 5px;
      font-family: Monospace;
      font-size: 13px;
      text-align: center;
      z-index: 1000;
    }

    a {
      color: #ffffff;
    }

    #oldie a {
      color: #da0
    }
  </style>
</head>

<body>

<script type="text/javascript" src="resources/jquery-2.0.0.min.js"></script>
<script src="resources/three.min.js"></script>
<script src="resources/TrackballControls.js"></script>
<script src="resources/FirstPersonControls.js"></script>
<script src="resources/OrbitControls.js"></script>
<script src="resources/Detector.js"></script>

<script>

  if (!Detector.webgl) Detector.addGetWebGLMessage();

  var container;

  var camera, scene, renderer;

  var mesh, lightMesh, sphere;
  var spheres = [];

  var projector;

  var directionalLight, pointLight;

  var windowHalfX = window.innerWidth / 2;
  var windowHalfY = window.innerHeight / 2;

  var clock = new THREE.Clock();

  var currentInfo;

  $.ajax({
    type: 'GET',
    dataType: 'html',
    url: "all_gliese",
    success: function (data) {
      var dataParsed = JSON.parse(data);

      init(dataParsed);
      animate();

    }
  });

  var controls;

  function init(stars) {

    scene = new THREE.Scene();

    container = document.createElement('div');
    document.body.appendChild(container);

    currentInfo = document.createElement( 'div' );
    currentInfo.style.position = 'absolute';
    currentInfo.style.top = '10px';
    currentInfo.style.width = '100%';
    currentInfo.style.textAlign = 'right';
    currentInfo.innerHTML = '';
    container.appendChild( currentInfo );


    directionalLight = new THREE.DirectionalLight(0xffffff);
    directionalLight.position.set(1, 1, 2).normalize();
    scene.add(directionalLight);

    sphere = new THREE.SphereGeometry(.1, 16, 8);

    camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
    camera.position.z = 0;

    controls = new THREE.FirstPersonControls(camera);
    controls.movementSpeed = 15;
    controls.lookSpeed = 0.1;

    //  the sun
    var mesh = new THREE.Mesh(sphere, new THREE.MeshPhongMaterial({ ambient: 0x000000, color: 0xFFCC00, specular: 0x555555, shininess: 30 }));
    mesh.position.x = 0;
    mesh.position.y = 0;
    mesh.position.z = 0;
    scene.add(mesh);
    spheres.push(mesh);

    stars.forEach(function (star) {
      var mesh = new THREE.Mesh(sphere, new THREE.MeshPhongMaterial({ ambient: 0x000000, color: 0x55ff00, specular: 0x555555, shininess: 30 }));

      console.log(star.cartesianCoordsInLys);

      mesh.position.x = star.cartesianCoordsInLys.x;
      mesh.position.y = star.cartesianCoordsInLys.y;
      mesh.position.z = star.cartesianCoordsInLys.z;

      mesh.scale.x = mesh.scale.y = mesh.scale.z = 1;

      mesh.starData = star;

      scene.add(mesh);
      spheres.push(mesh);
    });

    projector = new THREE.Projector();

    renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.autoClear = false;
    container.appendChild(renderer.domElement);

    window.addEventListener('resize', onWindowResize, false);

//    document.addEventListener('mousedown', onDocumentMouseDown, false);
    document.addEventListener('mousemove', onMouseMove, false);

  }
//  function onDocumentMouseDown(event) {
//
//  }

  var onMouseMove = function ( event ) {
    console.log("mousey");

    var vector = new THREE.Vector3( ( event.clientX / window.innerWidth ) * 2 - 1, - ( event.clientY / window.innerHeight ) * 2 + 1, 0.5 );
    projector.unprojectVector( vector, camera );

    var raycaster = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );

    var intersects = raycaster.intersectObjects( spheres );

    if ( intersects.length > 0 ) {
      currentInfo.innerHTML = intersects[0].object.starData.name;
    }
  };

  function onWindowResize() {

    windowHalfX = window.innerWidth / 2;
    windowHalfY = window.innerHeight / 2;
    camera.aspect = window.innerWidth / window.innerHeight;

    camera.updateProjectionMatrix();

    renderer.setSize(window.innerWidth, window.innerHeight);

    controls.handleResize();

    render();

  }


  function animate() {

    requestAnimationFrame(animate);

    render();
  }

  function render() {

    controls.update(clock.getDelta());

    renderer.render(scene, camera);

  }

</script>

</body>
</html>
